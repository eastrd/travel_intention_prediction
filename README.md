# predict-travel-intention-using-the-individual-trajectory-data
数据来源于浙江省移动公司，利用用户的手机信号定位的位置信息，预测用户在接下来一段时间的旅行计划。

### 这个项目的几个难点：

1）因为是移动信号塔定位的信息，数据采集的频率有时很频繁，有时有很少，所以数据采集时间并没有太多规律，很可能一个人长时间呆在一个位置，然后却采集了多次的情况，所以需要对这种情况进行一些处理

2）位置定位始终会有一个问题，就是定位的地点会飘。换句话说，一个人可能一段时间内都呆在一个地方，但是位置的数据不一致。

### 数据表介绍
轨迹数据表

| 字段名称      | 中文解释    | 备注说明  |
| --------     | -----      |---------|
| user_id      |   用户标识  | 抽样&脱敏 |
| longitude    | 经度        | 保留小数点后三位 |
| latitude     | 维度        | 保留小数点后三位 |
| start_time   |数据采集时间  |datetime格式|

用户出行行为数据表

| 字段名称      | 中文解释         | 备注说明  |
| --------     | -----            |---------|
| user_id      |   用户标识        |  抽样&脱敏 |
| flag         | 是否有旅行出行需求 |	0：无出行意向；   1：有出行意向 |
| travel_type  | 旅游类型          |	当flag=0，travel_type=0；当flag=1，travel_type=1表示境外游、travel_type=2表示省外游、travel_type=3表示省内游 |

### 数据量统计结果
|            | 无出行意向（flag=0）    | 有出行意向（flag=1）  |
| --------   | -----                  |---------            |
| 原始轨迹数量       |   9,709,639   |23,371,410|
| 原始用户数量      | 5800  | 4200 |
| 除去异常值轨迹记录后的总轨迹数量 | 2,584,032  |5,700,187|
| 每天都无缺失记录的用户数量|3023|3532|
| 预处理后无缺失记录的用户数量|2,016,438|5,018,619|

|       | 用户数量    | 人均每天轨迹记录数量  |
| --------   | -----  |---------|
| 无旅行意向（travel_type=0）   | 5800  |16.564|
| 有境外游意向（travel_type=1） | 200   |48.009|
| 有省外游意向（travel_type=2） | 1500  |45.818|
| 有省内游意向（travel_type=3） | 2500  |44.671|
### 数据时间
轨迹数据是2018.6.1至2018.6.30；用户出行行为数据是2018.7.1至2018.7.31
### 研究问题
是否能够利用用户的轨迹数据，提取用户的出行特征，来预测用户接下来的出行计划。
### 研究思路
首先利用轨迹数据，提取特征，来说明这些特征是可以用来区别有无出行意向的用户。   
接下来利用轨迹网格，构建深度学习网络，来判断用户具体的旅游类型。
最后将深度学习网络学习到的特征和利用轨迹数据提取的特征进行融合，看是否对于预测效果有进一步的提升。
### 各个文件说明
feature.py存储了利用轨迹数据提取特征的过程。判断是否可以利用这些特征区分有无出行意向的用户

feature_classification.md存放了利用轨迹数据提取的各类特征后进行统计，说明有无出行意向的用户在这些特征中还是可以区分的。

keras_cnn.py是利用轨迹数据构建轨迹网格，然后用CNN的方法进行预测。

keras_dayofweek.py是利用轨迹数据构建轨迹网格，每个用户分别在一周七天的轨迹数据构建七张网格，然后用CNN的方法进行预测。

keras_dayoftime.py是利用轨迹数据构建轨迹网格，每个用户分别在一天时间内的4个时间段的轨迹数据构建四张网格，然后用CNN的方法进行预测。

convlstm.py是利用keras中convlstm的方法进行尝试，就是考虑到每天出行的时间因素进行预测，但是效果并不是很理想。可能的原因是，每个用户每天的出行轨迹记录太少，如果每天都形成一个轨迹网格的话，那么这个网格会很稀疏，导致最后的学习效果并不佳。而且用convlstm的方法还有一个问题，就是很耗费内存和时间。如果运行的电脑或者服务器的内存不是很大的话，慎用！

keras_fusion_all.py是将最开始提取的轨迹特征和利用CNN深度学习的方法学习到的参数进行融合，进行预测。
### 预测结果及结果分析
| 网络名称      | 预测的准确率    |
| --------   | -----:  |
| 普通CNN网络           |  79.41%  |
| dayoftime的CNN网络    |  78.85%  |
| dayofweek的CNN网络    |  78.69%  |

通过以上结果可以看出，其实三种网络的预测准确率差不多，但是普通CNN的网络比较简单，故接下来的内容都是基于普通CNN的网络进行。

![混淆矩阵](混淆矩阵.png)

从混淆矩阵上来看，CNN网络对于识别有无出行意向的用户（一类是0用户，一类是1,2,3用户）的准确率很高，但是对于区分1，2，3三类用户来说，效果比较差。

一种情况是本来这三类用户就比较难区分，因为其实很容易判断有无出行意愿，这是跟收入或者其经济情况有关。出行越有规律的人群，越能够说明，其每天都有一定的工作特点或者是出行特点。没有轨迹的人群，说明其每天无所事事，随处瞎逛。但是想要具体判断出行的类型，是用户基于自己具体的收入情况或者自己的喜好特点而决定的。举个例子，同样是一个公司的人，其每天的上班的规律都差不多。但是有高层也有普通工作人员，可能对于高层来说，其收入比较高，所以能够承担境外游的费用，但是对于普通人员来说，境外游的费用负担较重，所以可能倾向于选择省内游比较合适。对于这样的用户就很难区分开。

第二种情况是CNN模型对于后一类用户的区分能力不行。所以我把之前提取出来的特征和CNN学习到的特征进行融合，然后进行再次预测。预测后的准确率降到78%，其实没有任何进行。进一步分析原因，通过相关性分析发现，CNN学习到的特征和我提取的特征高度相关，所以肯定的是存在着过拟合的现象，所以会使预测效果变差。

这一部分的工作暂时进行到这里，因为另一个项目的原因，这个工作暂时告一段落。

但是其实后续的可进行拓展的工作还有很多，比如可以提取POI的特征；可以利用一些辅助的数据，进一步区分后一类用户；对于出行时间的划分也比较糙，等等。这些都是一些可以值得尝试的点。
